#!/bin/bash

#HOST=$(hostnamectl | grep 'hostname' | awk '{if (NR==1) {print substr($3, 1, length($2)-1)}}')

avahi_check(){
while [ true ]; do
	if [[ $(ping `hostname`.local -w 3) ]]; then
		sleep 1800s;
	else
		service avahi-daemon restart;
	fi
done
}

if [ -e /usr/local/sbin/avahi-check ]; then
	sleep 20s
	avahi_check;
fi
