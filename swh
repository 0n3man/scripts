#!/usr/bin/env bash
INTERFACE="wlan0"
FIND=`command -v governor`
DIR="/usr/local/bin/"
WHT="\e[1;37m"
FIN="\e[0m"

spinner(){
local i sp n
sp='|\-/'
n=${#sp}
while sleep 0.1; do
	printf "%s\b" "${sp:i++%n:1}"
done
}

# Commands
if [ $# -eq 0 ]; then
	echo "Missing options!"
	echo "(run $0 -h for help)"
	echo ""
	exit 0
fi

while getopts "hsudrWIU" OPTION; do
	case $OPTION in

	s)
		echo -en "${WHT}"
		echo -en "Scanning: "; spinner &

		printf '\n'
		sudo iwlist ${INTERFACE} scan | grep 'ESSID:\|Frequency:\|Quality=\|Encryption key:'

		kill "$!" # kill the spinner
		printf '\n'
		echo -en "${FIN}"
		;;
	u)
		echo ""
		echo "Bringing up interface."
		sudo ifup ${INTERFACE}
		echo "Done."
		echo ""
		;;
	d)
		echo ""
		echo "Bringing down interface."
		sudo ifdown ${INTERFACE}
		echo "Done."
		echo ""
		;;
	r)
		echo ""
		echo "Restarting ..."
		sudo ifdown ${INTERFACE}
		sudo "ifup ${INTERFACE}"
		;;
	W)
		sudo nano /etc/wpa_supplicant/wpa_supplicant.conf
		;;
	I)
		sudo nano /etc/network/interfaces
		;;
	U)
		if [[ `wget -S --spider http://github.com 2>&1 | grep 'HTTP/1.1 200 OK'` ]]; then
			sudo mv -f $FIND $FIND.orig
			sudo wget -cq https://raw.githubusercontent.com/pyavitz/scripts/master/swh -P $DIR
			sudo chmod +x $FIND
			if [ -f $FIND ]; then
				sudo rm -f $FIND.orig;
			else
				sudo mv -f $FIND.orig $FIND;
			fi
			swh -h;
		else
			echo -e "This script requires an internet connection to update.";
			exit 0;
		fi
		;;
	h)
		echo -e "${WHT}Simple wifi helper script${FIN}"
		echo -e "Usage: "
		echo ""
		echo -e "\t-s\tScan for SSID's"
		echo -e "\t-u\tBring up interface"
		echo -e "\t-d\tBring down interface"
		echo -e "\t-r\tRestart interface"
		echo -e "\t-W\tEdit wpa supplicant"
		echo -e "\t-I\tEdit interfaces"
		echo ""
		exit 0
		;;
	esac
done
